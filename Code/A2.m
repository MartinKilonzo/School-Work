
%% P1
% a)
im = [101   244   231   126   249;
      151   249   219     9    64;
      88    93    21   112   155;
      114    55    55   120   205;
      84   154    24   252    63];

F = [-1 0 1 ; -3 0 3; -1 0 1];

outIm = applyFilter(im,F)

% outIm =
%
%          981         458        -594        -101        -387
%         1084         267        -819        -313        -265
%          583        -192        -118         397        -465
%          412        -304         312         623        -724
%          517        -239         359         267        -876

s = sum(abs(outIm(:)))

% s =
%
%        11657


% b)
im = double(imread('swan.png'));

F = [-1 0 1 ; -3 0 3; -1 0 1];

outIm = applyFilter(im, F);

s = sum(abs(outIm(:)))

% s =
%
%      2937527

imwrite(uint8(stretch(outIm)), './swanFiltered.png');



%% P2
% a)
im = zeros(5,5,3);
im(:,:,1) =   [101   244   231   126   249;
                151   249   219     9    64;
                88    93    21   112   155;
                114    55    55   120   205;
                84   154    24   252    63];


im(:,:,2) =   [115   228   195    68   102;
                92    74   216    64   221;
                218   134   123    35   213;
                229    23   192   111   147;
                164   218    78   231   146];


im(:,:,3) =  [  91   201   137    85   182;
                225   102    91   122    60;
                85    46   139   162   241;
                101   252    31   100    69;
                158   198   196    26   239];

F = [ 1 3 0 -3 -1];
eng = computeEngGrad(im,F)

% eng =
%
%    1.0e+03 *
%
%     1.0482    0.6229    0.6974    0.3918    0.7198
%     0.6436    0.3150    0.3294    0.3519    0.4289
%     0.3674    0.1294    0.3535    0.3169    0.4061
%     0.4456    0.1650    0.1605    0.1390    0.5056
%     0.8820    0.4255    0.3753    0.4358    0.8715

s = sum(eng(:))

% s =
%
%    1.1528e+04


% b)
im = double(imread('face.jpg'));

F = [ 1 3 0 -3 -1];

eng = computeEngGrad(im,F);

s = sum(eng(:))

% s =
%
%    4.5304e+06

imwrite(uint8(stretch(eng)), './faceEngG.jpg');



%% P3
% a)
im = [];
im(:,:,1) =   [101   244   231   126   249;
                151   249   219     9    64;
                88    93    21   112   155;
                114    55    55   120   205;
                84   154    24   252    63];


im(:,:,2) =   [115   228   195    68   102;
                92    74   216    64   221;
                218   134   123    35   213;
                229    23   192   111   147;
                164   218    78   231   146];


im(:,:,3) =  [  91   201   137    85   182;
                225   102    91   122    60;
                85    46   139   162   241;
                101   252    31   100    69;
                158   198   196    26   239];


W = [-3 1 -3];
eng = computeEngColor(im,W)

% eng =
%
%         -461       -1107        -909        -565       -1191
%        -1036        -979        -714        -329        -151
%         -301        -283        -357        -787        -975
%         -416        -898         -66        -549        -675
%         -562        -838        -582        -603        -760

s = sum(eng(:))

% s =
%
%       -16094


% b)
im = double(imread('cat.png'));

W = [-3 1 -3];

eng = computeEngColor(im,W);

s = sum(eng(:))

% s =
%
%    -58999407

imwrite(uint8(stretch(eng)), './catEngC.png');

%% P4
% a)
im = [];
im(:,:,1) =   [101   244   231   126   249;
                151   249   219     9    64;
                88    93    21   112   155;
                114    55    55   120   205;
                84   154    24   252    63];


im(:,:,2) =   [115   228   195    68   102;
                92    74   216    64   221;
                218   134   123    35   213;
                229    23   192   111   147;
                164   218    78   231   146];


im(:,:,3) =  [  91   201   137    85   182;
                225   102    91   122    60;
                85    46   139   162   241;
                101   252    31   100    69;
                158   198   196    26   239];


W = [-3 1 -3];
mask = [ -1 1 0 -1 0;...
         1 1 0 -1 1;...
         0 1 0 -1 -1;...
         1 1 0 -1 1;...
         -1 -1 0 1 0];
maskW = 10;

F = [1 3 0 -3 -1];
im4 = cat(3,im,mask);
eng = computeEng(im4,F,W,maskW)
%
% eng =
%
%   577.2127 -474.0578 -211.6035 -183.2227 -471.2210
%  -382.3976 -653.9937 -384.5538   12.8625  287.8903
%    66.4436 -143.5701   -3.5477 -480.0582 -578.8598
%    39.5649 -722.9933   94.4719 -420.0252 -159.3623
%   309.9671 -422.5076 -206.7120 -157.1606  111.4617


% b)
seam = [1 ;2 ;3; 4; 1];
imOut = removeSeamV(im4,seam)

% imOut(:,:,1) =
%
%    244   231   126   249
%    151   219     9    64
%     88    93   112   155
%    114    55    55   205
%    154    24   252    63
%
%
% imOut(:,:,2) =
%
%    228   195    68   102
%     92   216    64   221
%    218   134    35   213
%    229    23   192   147
%    218    78   231   146
%
%
% imOut(:,:,3) =
%
%    201   137    85   182
%    225    91   122    60
%     85    46   162   241
%    101   252    31    69
%    198   196    26   239
%
%
% imOut(:,:,4) =
%
%      1     0    -1     0
%      1     0    -1     1
%      0     1    -1    -1
%      1     1     0     1
%     -1     0     1     0


% c)
imOut = addSeamV(im4,seam)

% imOut(:,:,1) =
%
%    101   101   244   231   126   249
%    151   249   249   219     9    64
%     88    93    21    21   112   155
%    114    55    55   120   120   205
%     84    84   154    24   252    63
%
%
% imOut(:,:,2) =
%
%    115   115   228   195    68   102
%     92    74    74   216    64   221
%    218   134   123   123    35   213
%    229    23   192   111   111   147
%    164   164   218    78   231   146
%
%
% imOut(:,:,3) =
%
%     91    91   201   137    85   182
%    225   102   102    91   122    60
%     85    46   139   139   162   241
%    101   252    31   100   100    69
%    158   158   198   196    26   239
%
%
% imOut(:,:,4) =
%
%     -1    -1     1     0    -1     0
%      1     1     1     0    -1     1
%      0     1     0     0    -1    -1
%      1     1     0    -1    -1     1
%     -1    -1    -1     0     1     0


% d)
[M,P] = seamV_DP(eng)

% M =
%
%    1.0e+03 *
%
%     0.5772   -0.4741   -0.2116   -0.1832   -0.4712
%    -0.8565   -1.1281   -0.8586   -0.4584   -0.1833
%    -1.0616   -1.2716   -1.1316   -1.3387   -1.0372
%    -1.2321   -1.9946   -1.2442   -1.7587   -1.4980
%    -1.6846   -2.4171   -2.2013   -1.9159   -1.6472
%
%
% P =
%
%     -1    -1    -1    -1    -1
%      2     2     2     5     5
%      2     2     2     3     4
%      2     2     4     4     4
%      2     2     2     4     4


% e)
[seam,c] = bestSeamV(M,P)

%
% seam =
%
%      2
%      2
%      2
%      2
%      2
%
%
% c =
%
%   -2.4171e+03


% f)
[seam,im4Out,c] = reduceWidth(im4,eng)

% seam =
%
%      2
%      2
%      2
%      2
%      2
%
%
% im4Out(:,:,1) =
%
%    101   231   126   249
%    151   219     9    64
%     88    21   112   155
%    114    55   120   205
%     84    24   252    63
%
%
% im4Out(:,:,2) =
%
%    115   195    68   102
%     92   216    64   221
%    218   123    35   213
%    229   192   111   147
%    164    78   231   146
%
%
% im4Out(:,:,3) =
%
%     91   137    85   182
%    225    91   122    60
%     85   139   162   241
%    101    31   100    69
%    158   196    26   239
%
%
% im4Out(:,:,4) =
%
%     -1     0    -1     0
%      1     0    -1     1
%      0     0    -1    -1
%      1     0    -1     1
%     -1     0     1     0
%
%
% c =
%
%   -2.4171e+03


% g)
[seam,im4Out,c] = reduceHeight(im4,eng)

% seam =
%
%      2
%      2
%      2
%      3
%      3
%
%
% im4Out(:,:,1) =
%
%    101   244   231   126   249
%     88    93    21     9    64
%    114    55    55   120   205
%     84   154    24   252    63
%
%
% im4Out(:,:,2) =
%
%    115   228   195    68   102
%    218   134   123    64   221
%    229    23   192   111   147
%    164   218    78   231   146
%
%
% im4Out(:,:,3) =
%
%     91   201   137    85   182
%     85    46   139   122    60
%    101   252    31   100    69
%    158   198   196    26   239
%
%
% im4Out(:,:,4) =
%
%     -1     1     0    -1     0
%      0     1     0    -1     1
%      1     1     0    -1     1
%     -1    -1     0     1     0
%
%
% c =
%
%   -2.4799e+03


% h)
[seam,im4Out,c] = increaseWidth(im4,eng)

% seam =
%
%      2
%      2
%      2
%      2
%      2
%
%
% im4Out(:,:,1) =
%
%    101   244   244   231   126   249
%    151   249   249   219     9    64
%     88    93    93    21   112   155
%    114    55    55    55   120   205
%     84   154   154    24   252    63
%
%
% im4Out(:,:,2) =
%
%    115   228   228   195    68   102
%     92    74    74   216    64   221
%    218   134   134   123    35   213
%    229    23    23   192   111   147
%    164   218   218    78   231   146
%
%
% im4Out(:,:,3) =
%
%     91   201   201   137    85   182
%    225   102   102    91   122    60
%     85    46    46   139   162   241
%    101   252   252    31   100    69
%    158   198   198   196    26   239
%
%
% im4Out(:,:,4) =
%
%     -1     1     1     0    -1     0
%      1     1     1     0    -1     1
%      0     1     1     0    -1    -1
%      1     1     1     0    -1     1
%     -1    -1    -1     0     1     0
%
%
% c =
%
%   -2.4171e+03


% i)
[seam,im4Out,c] = increaseHeight(im4,eng)

% seam =
%
%      2
%      2
%      2
%      3
%      3
%
%
% im4Out(:,:,1) =
%
%    101   244   231   126   249
%    151   249   219     9    64
%    151   249   219   112   155
%     88    93    21   112   155
%    114    55    55   120   205
%     84   154    24   252    63
%
%
% im4Out(:,:,2) =
%
%    115   228   195    68   102
%     92    74   216    64   221
%     92    74   216    35   213
%    218   134   123    35   213
%    229    23   192   111   147
%    164   218    78   231   146
%
%
% im4Out(:,:,3) =
%
%     91   201   137    85   182
%    225   102    91   122    60
%    225   102    91   162   241
%     85    46   139   162   241
%    101   252    31   100    69
%    158   198   196    26   239
%
%
% im4Out(:,:,4) =
%
%     -1     1     0    -1     0
%      1     1     0    -1     1
%      1     1     0    -1    -1
%      0     1     0    -1    -1
%      1     1     0    -1     1
%     -1    -1     0     1     0
%
%
% c =
%
%   -2.4799e+03


% j)
[totalCost,imOut] = intelligentResize(im,1,0,W,mask,maskW)

% totalCost =
%
%   -3.5462e+03
%
%
% imOut(:,:,1) =
%
%    101   244   244   231   126   249
%    151   249   249   219     9    64
%     88    93    21    21   112   155
%    114    55    55    55   120   205
%     84   154   154    24   252    63
%
%
% imOut(:,:,2) =
%
%    115   228   228   195    68   102
%     92    74    74   216    64   221
%    218   134   123   123    35   213
%    229    23    23   192   111   147
%    164   218   218    78   231   146
%
%
% imOut(:,:,3) =
%
%     91   201   201   137    85   182
%    225   102   102    91   122    60
%     85    46   139   139   162   241
%    101   252   252    31   100    69
%    158   198   198   196    26   239

 [totalCost,imOut] = intelligentResize(im,-1,0,W,mask,maskW)

% totalCost =
%
%   -3.5462e+03
%
%
% imOut(:,:,1) =
%
%    101   231   126   249
%    151   219     9    64
%     88    93   112   155
%    114    55   120   205
%     84    24   252    63
%
%
% imOut(:,:,2) =
%
%    115   195    68   102
%     92   216    64   221
%    218   134    35   213
%    229   192   111   147
%    164    78   231   146
%
%
% imOut(:,:,3) =
%
%     91   137    85   182
%    225    91   122    60
%     85    46   162   241
%    101    31   100    69
%    158   196    26   239

[totalCost,imOut] = intelligentResize(im,0,-1,W,mask,maskW)

% totalCost =
%
%   -4.0555e+03
%
%
% imOut(:,:,1) =
%
%    101   249   219     9    64
%     88    93    21   112   155
%    114    55    55   120   205
%     84   154    24   252    63
%
%
% imOut(:,:,2) =
%
%    115    74   216    64   221
%    218   134   123    35   213
%    229    23   192   111   147
%    164   218    78   231   146
%
%
% imOut(:,:,3) =
%
%     91   102    91   122    60
%     85    46   139   162   241
%    101   252    31   100    69
%    158   198   196    26   239


[totalCost,imOut] = intelligentResize(im,2,-2,W,mask,maskW)

% totalCost =
%
%   -1.2632e+04
%
%
% imOut(:,:,1) =
%
%     88    93    21    21    21     9    64
%    114    55    55    55    55   120   205
%     84   154   154   154    24   252    63
%
%
% imOut(:,:,2) =
%
%    218   134   123   123   123    64   221
%    229    23    23    23   192   111   147
%    164   218   218   218    78   231   146
%
%
% imOut(:,:,3) =
%
%     85    46   139   139   139   122    60
%    101   252   252   252    31   100    69
%    158   198   198   198   196    26   239


% k)
imCat = double(imread('cat.png'));
W = [1, -2, 1];
mask = zeros(size(imCat));
maskW = 1;
[totalCost,imOut] = intelligentResize(imCat, -20, -20, W, mask, maskW);
totalCost

imwrite(uint8(stretch(imOut)), './catResized.png');

% totalCost =
%
%   -1.0109e+06

imFace = double(imread('face.jpg'));
W = [1, -2, 1];
mask = double(imread('faceMask.png'));
maskW = -100;
[totalCost,imOut] = intelligentResize(imFace, -20, -20, W, mask, maskW);
totalCost

imwrite(uint8(stretch(imOut)), './faceResized.png');

% totalCost =
%
%   -4.0257e+05

%% P5
rng(0);  % set  random number generator to the same starting point

A = [ 1 0 3; 2 1 2; 1 3 3 ];
imSmall = cat(3,A,A,A);
scribbleSmall = [1 0 0; 1 0 0; 0 2 2];

lambda = 1;
numClusters = 0;
inftyCost = 1000;

[segm,e2]  = segmentGC(imSmall,scribbleSmall,lambda,numClusters,inftyCost)
%
% sigma2 =
%
%     2.0833
%
%
% W =
%
%     1.0000    4.0000    0.7866
%     2.0000    5.0000    0.7866
%     3.0000    6.0000    0.3829
%     4.0000    7.0000    0.1153
%     5.0000    8.0000    0.7866
%     6.0000    9.0000    1.0000
%     1.0000    2.0000    0.7866
%     4.0000    5.0000    0.7866
%     7.0000    8.0000    0.7866
%     2.0000    3.0000    0.3829
%     5.0000    6.0000    0.7866
%     8.0000    9.0000    0.7866
%     4.0000    1.0000    0.7866
%     5.0000    2.0000    0.7866
%     6.0000    3.0000    0.3829
%     7.0000    4.0000    0.1153
%     8.0000    5.0000    0.7866
%     9.0000    6.0000    1.0000
%     2.0000    1.0000    0.7866
%     5.0000    4.0000    0.7866
%     8.0000    7.0000    0.7866
%     3.0000    2.0000    0.3829
%     6.0000    5.0000    0.7866
%     9.0000    8.0000    0.7866
%
%
% segm =
%
%   3x3 logical array
%
%    0   0   0
%    0   0   0
%    0   1   1
%
%
% e2 =
%
%     1.5524
